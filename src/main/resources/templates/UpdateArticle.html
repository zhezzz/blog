<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>修改文章</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" th:src="@{/static/js/ckeditor/ckeditor.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/ckeditor/translations/zh-cn.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/jquery/jquery-3.3.1.min.js}"></script>
</head>
<body>

<form>
    <input type="text" name="title" th:value="${article.getTitle()}">
    <textarea name="content" id="editor">
    </textarea>
    <input type="checkbox" name="publish" checked>
    <button type="submit" id="submit" onclick="submit()">保存</button>
</form>

<script th:inline="javascript">
    var content = [[${article.getContent()}]];
    var articleId = [[${article.getArticleId()}]];
    var contextPath = [[${#request.getContextPath()}]];
    var editorData;
    var myEditor;
    ClassicEditor
        .create(document.querySelector('#editor'), {
            language: 'zh-cn',
            ckfinder: {
                uploadUrl: contextPath + '/article/upload/' + articleId
            },
        })
        .then(editor => {
            console.log(editor);
            editor.setData(content);
            myEditor = editor;
        })
        .catch(error => {
            console.error(error);
        });

    var form_data = $("#form").serialize();

    function submit() {
        editorData = myEditor.getData();
        $.ajax({
            type: "PUT",
            url: content + '/article/' + articleId,
            data: form_data,
            success: function (result) {
                alert("成功！");
            },
            error: function () {
                alert("异常！");
            }
        })
    }

    // function submit() {
    //     $.ajax({
    //         type: "DELETE",
    //         url: content + '/article/' + articleId,
    //         contentType:"application/json",
    //         success: function (result) {
    //             alert("成功！");
    //         },
    //         error : function() {
    //             alert("异常！");
    //         }
    //     })
    // }
</script>
</body>
</html>